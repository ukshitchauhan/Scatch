<%- include('./partials/header') %>

<div class="min-h-screen bg-zinc-950 text-white font-sans selection:bg-purple-500 selection:text-white pb-20">
    
    <div class="container mx-auto px-4 pt-20">

        <div class="flex flex-col md:flex-row items-end justify-between gap-4 border-b border-zinc-800 pb-8 mb-8">
            <div>
                <span class="text-purple-500 text-xs tracking-widest uppercase font-semibold">Final Step</span>
                <h1 class="text-4xl md:text-5xl font-bold tracking-tighter mt-2">
                    Checkout<span class="text-zinc-600">.</span>
                </h1>
            </div>
            <a href="/users/cart" class="text-zinc-500 text-sm hover:text-white transition-colors flex items-center gap-1">
                <i class="ri-arrow-left-line"></i> Back to Cart
            </a>
        </div>

        <div class="flex flex-col lg:flex-row gap-12">
            
            <div class="w-full lg:w-[65%]">
                
                <form action="/users/order/place" method="post" id="checkout-form">
                    
                    <div class="mb-10">
                        <h3 class="text-xl font-bold text-white mb-6 flex items-center gap-3">
                            <span class="w-8 h-8 rounded-full bg-purple-600/20 text-purple-400 flex items-center justify-center text-sm border border-purple-500/30">1</span>
                            Shipping Details
                        </h3>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            
                            <div class="group">
                                <label class="block text-xs font-medium text-zinc-500 mb-2 uppercase tracking-wide">Full Name</label>
                                <input type="text" name="fullname" placeholder="John Doe" value="<%=user.fullname%>"
                                    class="w-full bg-zinc-900 border border-zinc-800 rounded-xl py-3 px-4 text-white focus:outline-none focus:border-purple-500 focus:ring-1 focus:ring-purple-500 transition-all placeholder-zinc-700">
                            </div>

                            <div class="group">
                                <label class="block text-xs font-medium text-zinc-500 mb-2 uppercase tracking-wide">Email Address</label>
                                <input type="email" name="email" placeholder="john@example.com" value="<%=user.email%>"
                                    class="w-full bg-zinc-900 border border-zinc-800 rounded-xl py-3 px-4 text-white focus:outline-none focus:border-purple-500 focus:ring-1 focus:ring-purple-500 transition-all placeholder-zinc-700">
                            </div>

                            <div class="group md:col-span-2">
                                <label class="block text-xs font-medium text-zinc-500 mb-2 uppercase tracking-wide">Address</label>
                                <input type="text" name="address" placeholder="123 Street Name, Area"
                                    class="w-full bg-zinc-900 border border-zinc-800 rounded-xl py-3 px-4 text-white focus:outline-none focus:border-purple-500 focus:ring-1 focus:ring-purple-500 transition-all placeholder-zinc-700">
                            </div>

                            <div class="group">
                                <label class="block text-xs font-medium text-zinc-500 mb-2 uppercase tracking-wide">City</label>
                                <input type="text" name="city" placeholder="Mumbai"
                                    class="w-full bg-zinc-900 border border-zinc-800 rounded-xl py-3 px-4 text-white focus:outline-none focus:border-purple-500 focus:ring-1 focus:ring-purple-500 transition-all placeholder-zinc-700">
                            </div>

                            <div class="group">
                                <label class="block text-xs font-medium text-zinc-500 mb-2 uppercase tracking-wide">Postal Code</label>
                                <input type="text" name="zip" placeholder="400001"
                                    class="w-full bg-zinc-900 border border-zinc-800 rounded-xl py-3 px-4 text-white focus:outline-none focus:border-purple-500 focus:ring-1 focus:ring-purple-500 transition-all placeholder-zinc-700">
                            </div>

                        </div>
                    </div>

                
            </div>

            <div class="w-full lg:w-[35%]">
                <div class="bg-zinc-900/40 rounded-2xl p-6 border border-zinc-800/50 sticky top-24 backdrop-blur-sm">
                    <h2 class="text-lg font-bold mb-6 text-white border-b border-zinc-800 pb-4">Order Summary</h2>

                    <div class="flex flex-col gap-4 mb-6 max-h-60 overflow-y-auto pr-2 custom-scrollbar">
                        
                        <% let total = 0; %>
                        <% let totalDiscount = 0; %>
                        
                        <% cart.forEach(item => { 
                            const product = item.product;
                            const finalPrice = Math.floor(product.price - (product.price * product.discount / 100));
                            const itemTotal = finalPrice * item.quantity;
                            total += itemTotal;
                            totalDiscount += (product.price - finalPrice) * item.quantity;
                        %>
                            <div class="flex gap-4 items-center">
                                <div class="w-12 h-16 bg-zinc-900 rounded overflow-hidden flex-shrink-0 border border-zinc-800">
                                    <img src="<%= product.image %>" class="w-full h-full object-cover opacity-80">
                                </div>
                                <div class="flex-grow">
                                    <h4 class="text-sm font-medium text-zinc-200 line-clamp-1"><%= product.name %></h4>
                                    <p class="text-xs text-zinc-500">Qty: <%= item.quantity %></p>
                                </div>
                                <div class="text-right">
                                    <span class="text-sm font-medium text-white">₹<%= itemTotal %></span>
                                </div>
                            </div>
                        <% }) %>

                    </div>
                    
                    <div class="space-y-3 mb-6 border-t border-zinc-800 pt-4">
                        <div class="flex justify-between items-center text-sm">
                            <span class="text-zinc-400">Subtotal</span>
                            <span class="text-zinc-200">₹<%= total + totalDiscount %></span>
                        </div>
                        
                        <% if(totalDiscount > 0) { %>
                            <div class="flex justify-between items-center text-sm">
                                <span class="text-zinc-400">Discount</span>
                                <span class="text-purple-400">- ₹<%= totalDiscount %></span>
                            </div>
                        <% } %>

                        <div class="flex justify-between items-center text-sm">
                            <span class="text-zinc-400">Delivery</span>
                            <span class="text-zinc-200">Free</span>
                        </div>
                    </div>

                    <div class="border-t border-zinc-800 pt-4 mb-6">
                        <div class="flex justify-between items-end">
                            <span class="text-base font-bold text-white">Total Amount</span>
                            <span class="text-2xl font-bold text-white tracking-tight">₹<%= total %></span>
                            <input type="hidden" name="totalAmount" value="<%=total %>">
                        </div>
                    </div>

                    <button type="submit" form="checkout-form"
                        class="block w-full bg-white text-black hover:bg-zinc-200 text-center py-4 rounded-xl font-bold text-sm transition-all flex items-center justify-center gap-2 group">
                        Pay & Place Order 
                        <i class="ri-arrow-right-line group-hover:translate-x-1 transition-transform"></i>
                    </button>
                    
                    <div class="mt-4 flex justify-center gap-4 text-zinc-600 text-xl">
                        <i class="ri-secure-payment-line" title="Secure Payment"></i>
                        <i class="ri-visa-line"></i>
                        <i class="ri-mastercard-line"></i>
                    </div>
                </div>
            </div>
</form>
        </div>
    </div>
</div>

<%- include('./partials/footer') %>